"""
Insertion Sort — Сортировка вставками

Идея: Как сортировка карт в руке — берём следующий элемент и вставляем
его в правильное место среди уже отсортированных.

Сложность:
    - Время (лучший): O(n) — уже отсортировано!
    - Время (средний/худший): O(n²)
    - Память: O(1) — in-place
    - Стабильность: ДА
"""


def insertion_sort(arr: list) -> list:
    """
    Классическая реализация Insertion Sort.
    Сортирует список на месте (in-place).
    """
    for i in range(1, len(arr)):
        key = arr[i]  # Элемент, который будем вставлять
        j = i - 1

        # Сдвигаем элементы вправо, пока они больше key
        while j >= 0 and arr[j] > key:
            arr[j + 1] = arr[j]
            j -= 1

        # Вставляем key на своё место
        arr[j + 1] = key

    return arr


def insertion_sort_with_steps(arr: list) -> list:
    """
    Версия с выводом каждого шага — для демонстрации на уроке.
    """
    a = arr.copy()  # Не портим оригинал

    print(f"Исходный массив: {a}")
    print(f"[{a[0]}] — считаем первый элемент отсортированным")
    print("-" * 50)

    for i in range(1, len(a)):
        key = a[i]
        j = i - 1

        print(f"Шаг {i}: берём key = {key}")
        print(f"        отсортированная часть: {a[:i]}")

        shifts = 0
        while j >= 0 and a[j] > key:
            a[j + 1] = a[j]
            shifts += 1
            j -= 1

        a[j + 1] = key

        if shifts > 0:
            print(f"        сдвинули {shifts} элемент(ов) вправо")
            print(f"        вставили {key} на позицию {j + 1}")
        else:
            print(f"        {key} уже на своём месте (больше предыдущих)")

        print(f"        результат: {a}")
        print()

    print(f"Отсортировано: {a}")
    return a


# ============================================================
# ДЕМОНСТРАЦИЯ
# ============================================================

if __name__ == "__main__":

    # Пример 1: Пошаговая демонстрация
    # print("\n" + "=" * 50)
    # print("ПРИМЕР 1: Пошаговая демонстрация")
    # print("=" * 50 + "\n")
    #
    # demo = [34, 8, 64, 51, 32, 21]
    # insertion_sort_with_steps(demo)

    # Пример 2: Уже отсортированный — O(n)!
    # print("\n" + "=" * 50)
    # print("ПРИМЕР 2: Уже отсортированный массив")
    # print("=" * 50)
    #
    # sorted_arr = [1, 2, 3, 4, 5]
    # print(f"До:    {sorted_arr}")
    # insertion_sort_with_steps(sorted_arr)
    # print(f"После: {sorted_arr}")
    # print("✅ Для отсортированного — всего O(n) операций! (лучший случай)")

    # # Пример 3: Худший случай — обратный порядок
    print("\n" + "=" * 50)
    print("ПРИМЕР 4: Обратный порядок (худший случай)")
    print("=" * 50)

    reverse_arr = [5, 4, 3, 2, 1]
    print(f"До:    {reverse_arr}")
    insertion_sort_with_steps(reverse_arr)
    print(f"После: {reverse_arr}")
    print("⚠️  Худший случай — каждый элемент сдвигается максимально")
